import{_ as R,r as x,T as z,c as _,o as J,t as I,W as i,a as s,b as f,d as C,u as a,F as y,e as u,w as M,f as h,C as c,g as Q,h as d,i as X,j as S,k as L,l as V,m as Y,n as Z,p as r,q as ee,s as le,v as ne}from"./index-57225123.js";import K from"./nife-panel-b2e96333.js";import A from"./world-editor-202fb839.js";import{T as E}from"./world-meta-item-9d1debce.js";const W=b=>(le("data-v-81b7231d"),b=b(),ne(),b),te=W(()=>d("br",null,null,-1)),ae=W(()=>d("br",null,null,-1)),oe=W(()=>d("br",null,null,-1)),se=["innerHTML"],ue={__name:"world",setup(b){const k=x(new z),o=_(()=>k.value.info),t=_(()=>o.value?.world),m=_(()=>t.value.nifes),p=x(!1);J(()=>I.emitChanged("mounted")),I.addTabHandle("hashverse-@danor-world",k,l=>{const[e]=l.params;l.info.World=i,e?(l.info.world=e,l.title=`${l.info.world.name}`):l.info.raw=i.setMetaDefault(i.meta)});const H=l=>{const e=o.value.world=new i(l);k.value.title=`${e.name}`,p.value=!1,r.worlds.push(e),r.save()},O=()=>{o.value.raw=t.value.toRaw(),p.value=!0},U=l=>{const e=o.value.world,n=o.value.world=new i(l);k.value.title=`${n.name}`,p.value=!1,r.worlds.splice(e,1,n),r.save()},F=()=>{t.value.flush(),t.value.nifes.forEach(l=>l.flush()),r.save()},v=x(""),N=async l=>{~t.value.nifes.findIndex(e=>e.name==l)||(t.value.born({name:l}),v.value="",r.save())},j=l=>{const e=m.value.indexOf(l);e>-1&&m.value.splice(e,1),T(l),r.save()},q=()=>{m.value.splice(0,m.value.length),r.save()},$=_(()=>t.value.namesFighter.map(l=>t.value.nifes.find(e=>e.name==l))),D=l=>{t.value.namesFighter.length<2&&(t.value.namesFighter.push(l.name),r.save())},T=l=>{const e=t.value.namesFighter.indexOf(l.name);~e&&(t.value.namesFighter.splice(e,1),r.save())},G=x(null),w=x([]),P=()=>{const l=new ee($.value[0],$.value[1],t.value);l.start(),w.value.splice(0,w.value.length),w.value.unshift("--------------新的战斗--------------"),w.value.unshift(...l.logs.reverse())};return(l,e)=>(s(),f("module",null,[t.value&&p.value?(s(),C(A,{key:0,data:o.value.raw,"world-frame":a(i),"action-submit":"修改",onSubmit:U,onClose:e[0]||(e[0]=n=>p.value=!1)},null,8,["data","world-frame"])):!t.value&&o.value.raw?(s(),C(A,{key:1,data:o.value.raw,"world-frame":a(i),"action-submit":"创建",onSubmit:H},null,8,["data","world-frame"])):t.value?(s(),f(y,{key:2},[u(a(E),{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n),"name-new":"",align:"center",label:"名","label-split":" ",onKeyup:e[2]||(e[2]=M(h(n=>N(v.value),["exact"]),["enter"]))},null,8,["modelValue"]),u(a(c),{button:"",text:"加入",onClick:e[3]||(e[3]=n=>v.value&&N(v.value))}),u(a(c),{button:"",text:"清空",onClick:q}),u(a(E),{modelValue:o.value.world.seed,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.world.seed=n),class:"inblock m-4 ml-0 w-40 p-1",align:"center",label:"种子","label-split":" ",onKeyup:M(h(F,["exact"]),["enter"])},null,8,["modelValue","onKeyup"]),u(a(c),{button:"",text:"变换",onClick:F}),u(a(c),{button:"",text:"随机变换",onClick:e[5]||(e[5]=n=>(o.value.world.seed=a(Q)(6),F()))}),u(a(c),{button:"",text:"编辑世界",onClick:O}),te,d("p-nifes-box",null,[d("div",null,[u(a(S),{icon:a(X)},null,8,["icon"]),L(" 你的nifes")]),(s(!0),f(y,null,V(m.value,(n,g)=>(s(),C(K,{key:`nife-${g}`,nife:n,onClick:h(B=>D(n),["left","exact"]),onContextmenu:h(B=>j(n),["right","exact","prevent"])},null,8,["nife","onClick","onContextmenu"]))),128)),d("div",null,[u(a(S),{icon:a(Y)},null,8,["icon"]),L(" 出战的nifes")]),(s(!0),f(y,null,V($.value,(n,g)=>(s(),C(K,{key:`nife-fight-${g}`,nife:n,onContextmenu:h(B=>T(n),["right","exact","prevent"])},null,8,["nife","onContextmenu"]))),128)),ae,u(a(c),{button:"",text:"开始",onClick:P}),oe]),d("p-fight-log-box",{ref_key:"eBoxLog",ref:G},[(s(!0),f(y,null,V(w.value,(n,g)=>(s(),f("p-log",{key:`nife-fight-log-${g}`,innerHTML:n},null,8,se))),128))],512)],64)):Z("",!0)]))}},fe=R(ue,[["__scopeId","data-v-81b7231d"]]);export{fe as default};
